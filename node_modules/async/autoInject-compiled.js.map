{"version":3,"sources":["autoInject.js"],"names":[],"mappings":"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","file":"autoInject-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = autoInject;\n\nvar _auto = require('./auto');\n\nvar _auto2 = _interopRequireDefault(_auto);\n\nvar _baseForOwn = require('lodash/_baseForOwn');\n\nvar _baseForOwn2 = _interopRequireDefault(_baseForOwn);\n\nvar _arrayMap = require('lodash/_arrayMap');\n\nvar _arrayMap2 = _interopRequireDefault(_arrayMap);\n\nvar _copyArray = require('lodash/_copyArray');\n\nvar _copyArray2 = _interopRequireDefault(_copyArray);\n\nvar _isArray = require('lodash/isArray');\n\nvar _isArray2 = _interopRequireDefault(_isArray);\n\nvar _trim = require('lodash/trim');\n\nvar _trim2 = _interopRequireDefault(_trim);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar FN_ARGS = /^(function)?\\s*[^\\(]*\\(\\s*([^\\)]*)\\)/m;\nvar FN_ARG_SPLIT = /,/;\nvar FN_ARG = /(=.+)?(\\s*)$/;\nvar STRIP_COMMENTS = /((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg;\n\nfunction parseParams(func) {\n    func = func.toString().replace(STRIP_COMMENTS, '');\n    func = func.match(FN_ARGS)[2].replace(' ', '');\n    func = func ? func.split(FN_ARG_SPLIT) : [];\n    func = func.map(function (arg) {\n        return (0, _trim2.default)(arg.replace(FN_ARG, ''));\n    });\n    return func;\n}\n\n/**\n * A dependency-injected version of the [async.auto]{@link module:ControlFlow.auto} function. Dependent\n * tasks are specified as parameters to the function, after the usual callback\n * parameter, with the parameter names matching the names of the tasks it\n * depends on. This can provide even more readable task graphs which can be\n * easier to maintain.\n *\n * If a final callback is specified, the task results are similarly injected,\n * specified as named parameters after the initial error parameter.\n *\n * The autoInject function is purely syntactic sugar and its semantics are\n * otherwise equivalent to [async.auto]{@link module:ControlFlow.auto}.\n *\n * @name autoInject\n * @static\n * @memberOf module:ControlFlow\n * @method\n * @see [async.auto]{@link module:ControlFlow.auto}\n * @category Control Flow\n * @param {Object} tasks - An object, each of whose properties is a function of\n * the form 'func([dependencies...], callback). The object's key of a property\n * serves as the name of the task defined by that property, i.e. can be used\n * when specifying requirements for other tasks.\n * * The `callback` parameter is a `callback(err, result)` which must be called\n *   when finished, passing an `error` (which can be `null`) and the result of\n *   the function's execution. The remaining parameters name other tasks on\n *   which the task is dependent, and the results from those tasks are the\n *   arguments of those parameters.\n * @param {Function} [callback] - An optional callback which is called when all\n * the tasks have been completed. It receives the `err` argument if any `tasks`\n * pass an error to their callback, and a `results` object with any completed\n * task results, similar to `auto`.\n * @example\n *\n * //  The example from `auto` can be rewritten as follows:\n * async.autoInject({\n *     get_data: function(callback) {\n *         // async code to get some data\n *         callback(null, 'data', 'converted to array');\n *     },\n *     make_folder: function(callback) {\n *         // async code to create a directory to store a file in\n *         // this is run at the same time as getting the data\n *         callback(null, 'folder');\n *     },\n *     write_file: function(get_data, make_folder, callback) {\n *         // once there is some data and the directory exists,\n *         // write the data to a file in the directory\n *         callback(null, 'filename');\n *     },\n *     email_link: function(write_file, callback) {\n *         // once the file is written let's email a link to it...\n *         // write_file contains the filename returned by write_file.\n *         callback(null, {'file':write_file, 'email':'user@example.com'});\n *     }\n * }, function(err, results) {\n *     console.log('err = ', err);\n *     console.log('email_link = ', results.email_link);\n * });\n *\n * // If you are using a JS minifier that mangles parameter names, `autoInject`\n * // will not work with plain functions, since the parameter names will be\n * // collapsed to a single letter identifier.  To work around this, you can\n * // explicitly specify the names of the parameters your task function needs\n * // in an array, similar to Angular.js dependency injection.\n *\n * // This still has an advantage over plain `auto`, since the results a task\n * // depends on are still spread into arguments.\n * async.autoInject({\n *     //...\n *     write_file: ['get_data', 'make_folder', function(get_data, make_folder, callback) {\n *         callback(null, 'filename');\n *     }],\n *     email_link: ['write_file', function(write_file, callback) {\n *         callback(null, {'file':write_file, 'email':'user@example.com'});\n *     }]\n *     //...\n * }, function(err, results) {\n *     console.log('err = ', err);\n *     console.log('email_link = ', results.email_link);\n * });\n */\nfunction autoInject(tasks, callback) {\n    var newTasks = {};\n\n    (0, _baseForOwn2.default)(tasks, function (taskFn, key) {\n        var params;\n\n        if ((0, _isArray2.default)(taskFn)) {\n            params = (0, _copyArray2.default)(taskFn);\n            taskFn = params.pop();\n\n            newTasks[key] = params.concat(params.length > 0 ? newTask : taskFn);\n        } else if (taskFn.length === 1) {\n            // no dependencies, use the function as-is\n            newTasks[key] = taskFn;\n        } else {\n            params = parseParams(taskFn);\n            if (taskFn.length === 0 && params.length === 0) {\n                throw new Error(\"autoInject task functions require explicit parameters.\");\n            }\n\n            params.pop();\n\n            newTasks[key] = params.concat(newTask);\n        }\n\n        function newTask(results, taskCb) {\n            var newArgs = (0, _arrayMap2.default)(params, function (name) {\n                return results[name];\n            });\n            newArgs.push(taskCb);\n            taskFn.apply(null, newArgs);\n        }\n    });\n\n    (0, _auto2.default)(newTasks, callback);\n}\nmodule.exports = exports['default'];"]}